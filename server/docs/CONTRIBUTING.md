# Инструкция для разработчика

Инструкция для разработчика бекенда, здесь описаны детали проекта для лучшего понимания кода.
_В самом коде проставлены комментарии с описанием неочевидных моментов, то что описано там, здесь дублироваться не будет, здесь описываем только фундаментальные моменты._

## Ссылки

- [API документация](./API.md)
- [Лог изменений](./CHANGELOG.md)
- [Инструкция по установке](../README.md)

# Требования

- Javascript ES6 (async await, let const, () => {}, d = d ? d : null, const { d } = a) - опыт
- Typescript - опыт или желание разобраться

# Среда разработки

**Настоятельно рекомендуется использовать VSCode**

## Расширения VSCode

- prisma.prisma - синтаксис orm/prisma.schema
- dbaeumer.vscode-eslint - подсветка правил eslint
- esbenp.prettier-vscode - подстветка правил prettier
- humao.rest-client - выполнение запросов

## Установка

Базовая установка не отличается от того что описано в [инструкции по установке](../README.md#установка) отличается только сборка и запуск.

## Глобальные пакет node.js

```
nodemon v^2.0.7
prisma v^2.21.1
```

## Сборка и запуск

Для отслеживания изменений и пересборки:

```
yarn dev:watch
```

Для запуска сервера и авто перезапуска при изменениях

```
yarn dev:start
```

## Создание миграций

Чтобы создань миграцию после изменений в `orm/schena.prisma`:

```
yarn migrate:dev
```

Скрипт выполнит следующую последовательность, элементы которой можно запускать и поотдельности см. раздел scripts [package.json](../package.json#scripts):

- `yarn format` - проверяет и редактирует файл схемы
- `yarn generate` - генерирует типы схемы для `@prisma/client`
- `prisma migrate dev --preview-feature` - создает и проводит в базу новую миграцию, директиву сохраняет в папку `orm/migrations` и в таблицу базы `prisma_migrations`.

Быстрый просмотр данных в базе

```
yarn studio
```

Когда миграция не проводится из-за конфликта с уже загруженными данными, нужно либо руками удалить эти данные из базы, либо сделать сброс коммандой:

```
yarn migrate:reset
```

## Архитектура

Каждый файл является отдельным узким модулем, задача которого описана в комментарии в верху файла. Жедательно соблюдать архитектуру и в будущем. Тогда новым разработчикам, пришедшим на проект будет проще разобраться в деталях и эффективно приступить к работе.

## Проблемы кода

Архитектура кода составлялась на основе многочисленных проектов с учетом всех лучших практик. Однако ввиду того, что в этом проекте используется революционный подход (параметры для базы данных составляются на фронтенде), то здесь накладываются дополнительные заботы о безопасности, которые отражаются в глобальных посредниках `src/middleware/index.ts` и в локальных посредников в файле обработчика каждого роута в отдельности. На момент написания, проверены возможные дыры в безопасности и приняты соответствующие меры, однако стоит не забывать, что пользователь может передать в параметрах потенциально опасные значения в том случае, если мы сами в обработчике или в посреднике оперируем переданными параметрами. И если призма получит нехорошие параметры она сама с ними разберется, а вот если мы попытаемся вызвать то чего не передано. То в коде выкинет исключение `unhandledRejection`, а текущий запрос будет прерван.
